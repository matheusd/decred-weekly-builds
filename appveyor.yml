version: 0.1.{build}

cache:
  - node_modules
  - app\node_modules
  - '%APPDATA%\npm-cache'
  - '%USERPROFILE%\.electron'

platform:
  - x64

init:
  - git config --global core.autocrlf input
  - set PATH=%GOROOT%\bin;%GOPATH%\bin;%PATH%

install:
  - ps: Install-Product node 6 x64
  - git reset --hard HEAD
  - npm install npm -g
  - go version
  - go env
  - go get -u github.com/golang/dep/cmd/dep
  - git clone https://github.com/%GITHUB_DECRED_OWNER%/dcrd %GOPATH%/src/github.com/decred/dcrd
  - git clone https://github.com/%GITHUB_DECRED_OWNER%/dcrwallet %GOPATH%/src/github.com/decred/dcrwallet
  - git clone https://github.com/%GITHUB_DECRED_OWNER%/decrediton %GOPATH%/src/github.com/decred/decrediton
  - python before_install.py
  - cd %GOPATH%\\src\\github.com\\decred\\dcrd
  - dep ensure
  - go install . ./cmd/dcrctl/
  - cd ../dcrwallet
  - dep ensure
  - go install
  - dir %GOPATH%\\bin
  - cd ../decrediton
  - mkdir bin
  - cp %GOPATH%\\bin\\dcrd.exe bin/
  - cp %GOPATH%\\bin\\dcrctl.exe bin/
  - cp %GOPATH%\\bin\\dcrwallet.exe bin/
  - yarn
  - yarn package
  - dir %GOPATH%\\src\\github.com\\decred\\decrediton\\release\\
  - mkdir %APPVEYOR_BUILD_FOLDER%\\artifacts
  - cp %GOPATH%\\src\\github.com\\decred\\decrediton\\release\\*.* %APPVEYOR_BUILD_FOLDER%\\artifacts

build_script:
  - echo "Hooray!"

test: off

environment:
  GOPATH: c:\gopath
  GOROOT: C:\go

artifacts:
  - path: '.\artifacts'
    name: DecreditonRelease

deploy:
  provider: GitHub
  auth_token:
    secure: '%GITHUB_OAUTH_TOKEN%'
  artifact: '.\artifacts\*.exe'
  draft: false
  prerelease: false
  on:
    branch: master                 # release from master branch only
    appveyor_repo_tag: true        # deploy on tag push only
